# 🧠 가상 메모리(Virtual Memory) 정리

## 📌 가상 메모리란?

**가상 메모리는 운영체제가 제공하는 메모리 관리 기법**으로,  
**실제 물리 메모리(RAM)의 크기와 관계없이 더 큰 메모리 공간을 제공하는 기술**입니다.

---

## 🧠 왜 가상 메모리가 필요할까?

1. **RAM의 한계 극복**  
   → 여러 프로그램을 동시에 실행하려면 RAM만으로는 부족함

2. **프로세스 간 메모리 보호**  
   → 각각의 프로그램이 독립된 메모리 공간을 가지게 하기 위함

3. **주소 충돌 방지**  
   → 서로 다른 프로그램이 같은 가상 주소를 써도 문제가 없도록

4. **자원 효율화**  
   → 필요한 부분만 물리 메모리에 올리고 나머지는 디스크로 대체

---

## 🧩 어떻게 작동할까?

| 구성 요소 | 설명 |
|-----------|------|
| **가상 주소 (Virtual Address)** | 프로그램이 인식하는 주소 |
| **물리 주소 (Physical Address)** | 실제 RAM 주소 |
| **페이지 (Page)** | 가상/물리 메모리의 최소 단위 (보통 4KB) |
| **페이지 테이블** | 가상 주소를 물리 주소로 매핑 |
| **MMU (Memory Management Unit)** | 주소 변환을 수행하는 하드웨어 |

---

## 🔁 주소 변환 흐름

```
[가상 주소] → MMU → [페이지 테이블] → [물리 주소]
```

---

## 💾 물리 메모리가 부족하면?

운영체제는 **디스크의 일부 영역(Swap)** 을 이용해 부족한 RAM을 보완함  
→ 이를 **페이지 스와핑(Page Swapping)** 이라고 함

---

## ✅ 장점

| 장점 | 설명 |
|------|------|
| 메모리 보호 | 프로세스 간 메모리 침범 방지 |
| 메모리 확장 | RAM보다 큰 메모리 공간 제공 |
| 효율적 자원 사용 | 필요한 데이터만 메모리에 적재 |

---

## ❗ 단점

| 단점 | 설명 |
|------|------|
| 성능 저하 | 디스크 접근이 잦아지면 느려질 수 있음 |
| 복잡성 | 구현과 관리가 복잡함 |

---

## ✨ 비유로 이해하기

> 마치 작은 책상(RAM)에 필요한 책만 펼치고, 나머지는 책장(디스크)에 두는 것과 같음

---

## 📎 요약

- **가상 메모리**는 운영체제가 제공하는 메모리 관리 기능
- **프로세스마다 독립된 메모리 공간을 제공**
- **주소 변환, 페이지 관리, 스와핑**으로 RAM 자원을 효율적이고 안전하게 사용함
---

## 🖼 다이어그램으로 보는 가상 메모리

```
┌──────────────────────────────┐
│        사용자 프로그램       │
├──────────────────────────────┤
│         가상 주소 공간        │
│     (Virtual Address Space)  │
└────────────┬─────────────────┘
             │
             ▼
     [ Memory Management Unit ]
             │
             ▼
┌────────────┴────────────┐
│      페이지 테이블       │
│  (Virtual → Physical)   │
└────────────┬────────────┘
             │
             ▼
   ┌──────────────────────┐
   │   실제 물리 메모리    │
   │     (RAM)            │
   └──────────────────────┘
             │
             ▼
   ┌──────────────────────┐
   │  보조기억장치 (Disk)  │
   │    (Swap 영역 등)     │
   └──────────────────────┘
```

---

## 💻 예시 코드: 페이지 테이블 구조 (의사 코드)

```c
struct PageTableEntry {
    bool present;         // 물리 메모리에 존재 여부
    int frameNumber;      // 물리 프레임 번호
    bool readOnly;        // 읽기 전용 여부
    bool accessed;        // 접근 여부
    bool dirty;           // 쓰기 여부
};

PageTableEntry pageTable[NUM_PAGES];

int translateVirtualAddress(int virtualAddress) {
    int pageNumber = virtualAddress / PAGE_SIZE;
    int offset = virtualAddress % PAGE_SIZE;

    PageTableEntry entry = pageTable[pageNumber];

    if (!entry.present) {
        pageFaultHandler(pageNumber); // 디스크에서 페이지 불러오기
    }

    return entry.frameNumber * PAGE_SIZE + offset;
}
```

---

## ✅ 마무리 팁

- `MMU`와 `페이지 테이블`의 조합이 가상 → 물리 주소 변환의 핵심
- 가상 메모리는 프로그램에게 “넓은 공간”을 제공하고, OS는 “필요한 만큼만” 관리함
