
## 📅 2025년 4월 18일 (금) 하루 회고

### 1. 오늘 한 일

#### 💼 업무
- **환전(인증) 이벤트 응모 처리 중 객체 관리 이슈 수정**
  - 이벤트 처리 시, 요청/응답 객체를 분리하지 않고 같은 객체를 사용하여 검증 여부(`verifyYn`) 값이 초기화되는 문제 발견
  - 검증 여부가 `"Y"`일 때 후처리 로직이 동작하는데, 값이 사라져 후처리(update)가 정상적으로 수행되지 않음
  - 문제를 해결하기 위해, 로직을 탄 경우 `RVO` 객체에 `verifyYn = "Y"`를 강제 세팅
- **환전(인증) 이벤트 응모 처리 중 약관 세팅**
  - 놓친 부분이라서.. 할 말이 없음...
- **이벤트 데이터 조회 쿼리(RGS_DE 범위 조건) 개선 작업**
  - 기존에는 `CONCAT(CONVERT(...))` 방식으로 문자열을 조합하여 시작일/종료일을 계산
  - 개선 후 `DATEFROMPARTS`와 `EOMONTH`를 사용하여 날짜형 기반 비교로 변경
  - 가독성과 유지보수성을 높였으며, 추후 인덱스 최적화 가능성을 고려한 구조로 수정
---
## 🛠️ 쿼리 개선 비교 (RGS_DE 범위 조회)

### 기존 쿼리

```sql
AND A.RGS_DE BETWEEN CONCAT(CONVERT(VARCHAR(6), GETDATE(), 112), '01 00:00:00') 
AND CONCAT(CONVERT(VARCHAR(8), EOMONTH(GETDATE()), 112), ' 23:59:59')
```

- `CONCAT`, `CONVERT`를 이용해 문자열 형태로 날짜를 가공하여 비교
- 가독성이 떨어지고, 유지보수 시 헷갈릴 수 있음

---

### 개선된 쿼리

```sql
AND A.RGS_DE >= DATEFROMPARTS(YEAR(GETDATE()), MONTH(GETDATE()), 1)
AND A.RGS_DE < DATEADD(DAY, 1, EOMONTH(GETDATE()))
```

- `DATEFROMPARTS`로 이번 달 1일을 명확하게 생성
- `EOMONTH` + 1일 추가로 다음 달 1일 00:00:00을 만들어 경계 비교
- 타입 일관성 확보, 가독성 개선, 향후 인덱스 최적화 대비 가능

---

## 📈 개선 이유 요약

| 항목 | 기존 쿼리 | 개선된 쿼리 |
|:---|:---|:---|
| 가독성 | 낮음 (문자열 조합) | 높음 (날짜 계산) |
| 유지보수성 | 낮음 (포맷 변경 위험) | 높음 (명시적 계산) |
| 인덱스 최적화 가능성 | 제한적 | 최적화 가능 |

--- 

### 2. 잘된 점 / 아쉬운 점

#### ✅ 잘된 점
- 문제 발생 원인을 명확히 분석하여 데이터 흐름상의 객체 관리 미숙에서 비롯된 것임을 파악함
- 요청과 응답 객체를 분리하는 설계 방향(PVO, RVO 분리)을 명확히 세우고, 개선 방안을 도출함
- 단순한 패치에 그치지 않고, 구조적 개선 필요성을 인식한 점

#### ⚠️ 아쉬운 점
- 초기에 요청과 응답을 같은 객체에 담음으로써 검증 여부 값이 초기화되는 기본적인 실수를 범함
- 데이터 흐름(특히 상태 유지/변경)에 대한 감수성과 주의가 부족했다는 점을 실감함

---

### 3. 다음 목표 🎯
- 이벤트 처리 로직 전반에 걸쳐 요청용(PVO), 응답용(RVO) 객체를 명확히 구분하여 사용하는 구조로 개선할 것
- 신규 기능 개발 및 유지보수 시, 데이터 흐름(상태 보존 여부)에 대한 의식을 가지고 코드를 작성할 것
- 하나의 mapper에는 개별적인 PVO, RVO 셋트가 필요하다는 것을 절실히 느낌
  
---

## 💡 인사이트 / 깨달음

- 요청과 응답을 하나의 객체로 처리하면 의도치 않은 값 초기화, 데이터 소실 문제가 발생할 수 있다.
- PVO와 RVO를 명확히 구분하는 것은 단순한 설계 문제가 아니라, **데이터 신뢰성과 유지보수성**에 직결된다.
- "작동만 하면 된다"가 아니라, **데이터 흐름이 왜 그렇게 되어야 하는지**까지 설계해야 좋은 코드가 된다.
- 초기에 잘못 짠 코드라도, 문제를 분석하고 개선 방향을 설정하는 과정이 중요하다.
- 즐겨찾기는 DB조회닷!
---

## 🧠 코딩 스타일 / 기억해둘 기준들
- 요청용 객체(PVO)와 응답용 객체(RVO)는 항상 분리해서 관리할 것 ➔ 흐름이 명확해지고, 디버깅이 쉬워진다.
- 로직을 타는 중간에 객체 속성(`verifyYn` 등)을 손실시키지 않도록 주의할 것 ➔ 값 보존에 민감해지기
- 데이터가 존재해야만 동작하는 후처리 로직(검증 여부 체크 등)은 사전에 값을 보장하는 방식으로 안전하게 처리
- 단기적인 해결(강제 셋팅) 이후에는 반드시 구조적 개선(객체 분리 등)까지 이어가기
- 작은 이슈라도, 흐름을 끊고 반드시 근본 원인을 파악하고 기록해두기 ➔ 다음 실수를 줄이는 자산이 된다

## 💬 오늘 느낀 점
- 오류는 조용히 덮기보다 투명하게 공유해야 성장할 수 있다.
- 실수 자체가 아니라 실수를 다루는 태도가 중요하다.
- 나만 알고 넘어가는 것은 성장에 도움이 되지 않는다.
